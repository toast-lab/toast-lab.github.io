<!DOCTYPE html>
<html>
<head>
<title>Lab 6 - Computer Architecture I - ShanghaiTech University</title>
<link rel="shortcut icon" type="image/png" href="../../favicon.ico">
<meta charset="utf-8">
<style type="text/css">
code {background-color: #ddeeff; color: #000000;}
kbd {background-color: #ddeeff; color: #000000;}
.new {background-color: #ffff00; color: #000000;}

div.checkoff {
  background:#eeeee0;
  padding:0.5em 1.5em 0.5em 1.5em;
  border-radius:1em;
  border:1px solid #ddd;
}

pre {
  background:#adc384;
  padding:0.5em 1.5em 0.5em 1.5em;
/*   border-radius:1em; */
  border:1px solid #ddd;
}


</style>
<link rel="stylesheet" type="text/css" href="../style.css">

</head>
<body>
<header>
<h2>Lab 6</h2>
</header>
<a href="../../">Computer Architecture I</a> <a href="http://www.shanghaitech.edu.cn">ShanghaiTech University</a><br>
<a href="../5">Lab 5</a> Lab 6 <a href="../7">Lab 7</a>

<h2 id="setup">Get the files</h2>
<p>This lab extends topic of the previous lab, obtain files from the same <a href="https://autolab.sist.shanghaitech.edu.cn/gitlab/cs110/lab-5-starter">repository</a>.</p>

<h2 id="advanced-logisim">Advanced Logisim</h2>

<h3 id="setup-1">Setup</h3>

<p>Feel free to do each part as separate sub-circuits in the same Logisim file.</p>

<p>The following parts will introduce you to more advanced techniques/concepts in Logisim.</p>

<h3 id="advanced-features">Advanced Features</h3>

<p>Here are three Logisim features that should both save you a lot of time and make your circuits look much cleaner.</p>

<h4 id="splitters">Splitters</h4>

<p>Splitters allow you to take a multi-bit value and split it up into smaller parts, or (despite the name) combine multiple values that are one or more bits into a single value. Here, we split the 4-bit binary number <code>1001</code> into <code>10</code> and <code>01</code>, then recombine it with <code>11</code> into the final 6-bit number <code>111001</code>:</p>

<p><img src="./splitter_intro.png" width="300" /></p>

<p>Click on a splitter to get its menu in the sidebar. You can use this menu to determine the number of arms on your splitter and how many bits should go on each arm. For the circuit above, the left splitter's menu looks like this:</p>

<p><img src="./left_split_menu.png" width="300" /></p>

<p>While the right splitter's menu looks like this:</p>

<p><img src="./right_split_menu.png" width="300" /></p>

<p><strong>Notice that there's an option called</strong> <code>facing</code>. You can use this to rotate your splitter. Above, see that the splitter on the right is facing West while the splitter on the left is facing East.</p>

<p>If you see an error wire that is orange, this means that your bit width in does not match your bit width out. Make sure that if you're connecting two components with a wire, you correctly set the bit width in that component's menu.</p>

<p><img src="./orange_error.png" alt="" /></p>

<h4 id="tunnels">Tunnels</h4>

<p>A tunnel allows you draw an "invisible wire" to bind two points together. Tunnels are grouped by case-sensitive labels give to a wire. They are used to connect wires like so:</p>

<p><img src="./tunnels1.png" alt="" /></p>

<p>Which has an effect such as the following:</p>

<p><img src="./tunnels2.png" alt="" /></p>

<p>Some care should be taken as to which wires are connected with tunnels to which other wires, such as in this case:</p>

<p><img src="./tunnels3.png" alt="" /></p>

<p>Which in turn has the following effect:</p>

<p><img src="./tunnels4.png" alt="" /></p>

<p>We <em>strongly</em> recommend you use tunnels with Logisim, because they make your circuits much cleaner looking, and therefore easier to debug.</p>

<h4 id="extenders">Extenders</h4>

<p>When changing the width of a wire, you should use a bit extender for clarity. For example, consider the following implementation of extending an 8-bit wire into a 16-bit wire:</p>

<p><img src="./extend1.png" alt="" /></p>

<p>Whereas the following is much simpler, easier to read, and less error-prone:</p>

<p><img src="./extend2.png" alt="" /></p>

<p>Additionally consider the case of throwing out bits. In this example, an 8-bit wire is being converted into a 4-bit wire by throwing out the other bits:</p>

<p><img src="./extend3.png" alt="" /></p>

<p>Despite the implications of its name, a bit extender can also do this same operation:</p>

<p><img src="./extend4.png" alt="" /></p>

<h3 id="part-4-practice-with-splitters">Part 4: Practice with Splitters</h3>

<p>We're going to construct a circuit that manipulates an 8-bit number.</p>

<h4 id="action-item-3">Action Item</h4>
<p>Complete the following steps to create the splitter circuit, and show this to your TA (remember to save). When you've completed the circuit, answer the question in the checkoff session.</p>

<ol>
  <li>Open up the Exercise 4 schematic (<code>File-&gt;Open-&gt;ex4.circ</code>) and go to the empty Split circuit.</li>
  <li>
    <p>Go to the <code>Wiring</code> folder and select the <code>Splitter</code> circuit. This circuit will take a wire and split it into a set of wires of smaller width. Conversely, it can also take many sets of wires and combine them into one.</p>
  </li>
  <li>
    <p>Change the <code>Bit Width In</code> property (bus width) to <code>8</code>, and <code>Fan Out</code> property (# of branches) to <code>3</code>. Your splitter should now look as follows:</p>

    <p><img src="../../../19s/labs/6/splitter.gif" alt="" /></p>
  </li>
  <li>
    <p>Now, select which bits to send out to which part of your fan. The least significant bit is bit <code>0</code> and the most significant bit is bit <code>7</code>. Bit <code>0</code> should come out on fan arm <code>0</code>, bits <code>1</code>, <code>2</code>, <code>3</code>, <code>4</code>, <code>5</code> and <code>6</code> should come out on fan arm <code>1</code>, and bit <code>7</code> should come out on fan arm <code>2</code>. FYI: the <code>None</code> option means that the selected bit will not come out on ANY of the fan arms.</p>
  </li>
  <li>
    <p>Route <code>In1</code> to the splitter. Attach a 2-input <code>AND</code> gate to fan arms <code>0</code> and <code>2</code> and route the output of the <code>AND</code> gate to <code>Out1</code>.</p>
  </li>
  <li>
    <p>Now, interpret the input as a "sign and magnitude" number. Place logic gates and other circuits to make <code>Out2</code> to be the negative "sign and magnitude" value of the input. <a href="https://en.wikipedia.org/wiki/Signed_number_representations#Signed_magnitude_representation">Sign and magnitude</a> is an alternate way of representing signed values - like 2's Complement, but simpler! The combinational logic should be straight-forward.</p>
  </li>
  <li>
    <p>We will need another splitter to recombine the fans into a single 8-bit bus. Place another splitter with the proper properties (Bit Width In: 8, Fan Out: 3, correct fan widths). Play with the <code>Facing</code> and <code>Appearance</code> properties to make your final circuit as clean-looking as possible.</p>
  </li>
</ol>

<div class="checkoff">
<h4><a name="checkoff">Checkoff</a></h4>
<ul>
    <li>Show your <code>ex4.circ</code> to your TA.</li>
    <li>If we decide to take the input and interpret it as a 2's complement number, what inputs will produce Out1 = 1? <i>Hint: What do the first and last bits of a two's complement number being 1 tell you about the number?</i> </li>
</ul>
</div>

<h3 id="part-5-rotate-right">Part 5: Rotate Right</h3>

<p>With your knowledge of splitters and your knowledge and experience with multiplexers, you are ready to implement a non-trivial combinational logic block: <code>rotr</code>, which stands for "Rotate Right". The idea is that <code>rotr A,B</code> will "rotate" the bit pattern of input <code>A</code> to the right by <code>B</code> bits. So, if <code>A</code> were <code>0b1011010101110011</code> and <code>B</code> were <code>0b0101</code> (<code>5</code> in decimal), the output of the block would be <code>0b1001110110101011</code>. Notice that the rightmost <code>5</code> bits were rotated off the right end of the value and back onto the left end. In RTL, the operation would be something like <code>R = A &gt;&gt; B | A &lt;&lt; (16 - B)</code>.</p>

<h4 id="action-item-4">Action Item</h4>
<p>Implement a subcircuit named <code>rotr</code> with the following inputs:</p>
<ul>
  <li><code>A</code> (16-bit), the 16-bit input to be rotated</li>
  <li><code>B</code> (4-bit), the rotation amount (why 4 bits?)
You can find the starter subcircuit in <code>ex5.circ</code>.</li>
</ul>

<p>The output should be <code>A</code> rotated right by <code>B</code> bit positions, as outlined above. You are <strong>NOT</strong> allowed to use Logisim shifters in your solution, though all other combinational logic (MUXes, constants, gates, adders, etc.) is allowed. Logisim's built-in MUXes (find them under the <code>Plexers</code> menu) might be especialy helpful. Your solution shouldn't involve a clock or any clocked elements, like registers.</p>

<p><strong>Hint 1</strong>: Before you start wiring, you should think very carefully about how you might decompose this problem into smaller ones and join them together. You should feel very free to use subcircuits when implementing <code>rotr</code>. If you don't, expect to regret it.</p>

<p><strong>Hint 2</strong>: Just because we gave you an RTL representation doesn't mean it's the best way to look at this problem. Think about the input bits of <code>B</code> and think about how to effectively use splitters! Can you do something with the binary form? Remember why binary is good for use in computers: a <code>1</code> is easy to represent as an <code>ON</code> signal, and a <code>0</code> is easy to represent as an <code>OFF</code> signal. Let's say we want to rotate <code>9</code> times. <code>9</code> is <code>1001</code> in binary, or <code>1*8 + 0*4 + 0*2 + 1*1</code>. Can you use this to make a cleaner circuit? Making use of the rot* circuits we have provided is a good idea that will keep things clean!</p>

<div class="checkoff">
<h4><a name="checkoff">Checkoff</a></h4>
<ul>
    <li>Show your TA your <code>rotr</code> circuit and verify that it works. </li>
</ul>
</div>

<h2 id="testing">Testing</h2>

<p>The testing is the same as Lab 5.</p>

<footer>
<hr style="clear: both;"/>
<div style="float:left">
<address>
Schwertfeger, S&ouml;ren &lt;<code>soerensch</code> AT <code>shanghaitech.edu.cn</code>&gt;
</address>
<address>
Chundong Wang &lt;<code>wangchd</code> AT <code>shanghaitech.edu.cn</code>&gt;
</address>
Modeled after UC Berkeley's CS61C.<br>
Last modified: <time datetime="2020-04-07">2020-04-07</time>
</div>

</footer>
</body>
</html>
